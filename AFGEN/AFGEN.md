# AFGEN: Whole-Function Fuzzing for Applications and Libraries


### **背景与问题**
- **模糊测试**（Fuzzing）技术被广泛应用于漏洞发现，尤其是在API层级进行的模糊测试。然而，现有的模糊测试方法并不能涵盖应用程序或库中的所有函数，特别是库中的**内部函数**（内部函数比API函数复杂，因为它们的上下文依赖性较强）。
- **API函数**的上下文通常较为简单清晰，测试时可以直接对其进行输入，但是**内部函数**的上下文更加复杂，参数之间可能存在复杂的依赖关系，这使得直接为这些函数生成模糊测试用例变得困难。

### **创新点与解决方法**
- **Whole-function fuzzing**：提出了“全函数模糊测试”的方法，这是一种“自下而上”的模糊测试方法，旨在覆盖应用程序和库中的所有函数，而不是仅限于API接口。
  - **精确度与全覆盖的平衡**：通过设计上的优化，尽管可能牺牲一些精确度，但在全面覆盖所有函数的同时，精确度的损失是可以控制的。


### **AFGEN框架**
![AFGEN overview](image.png)
- **目标**：AFGEN的目标是自动生成一个模糊测试用例，能够覆盖目标函数，并且能够有效处理函数上下文中的依赖关系。
  - **工作原理**：
    1. **切片技术**：基于控制流和数据流的依赖关系，切出目标函数的调用语句。
    2. **变量赋值**：为切片代码中必要的变量根据其类型分配合理的值。
    3. **约束分析**：分析与崩溃相关的变量约束条件，进一步优化生成的模糊测试用例。
  - **效果**：AFGEN生成的模糊测试用例具有较低的误报率（false positive rate），能够有效减少无效的崩溃报告。

### **实验与验证**
- **实验数据**：
  - 论文使用了11个开源项目中的102个已知漏洞作为测试样本。
  - AFGEN能够成功为所有目标漏洞函数生成模糊测试用例，并发现了其中66个漏洞。
  - 相较于其他工具（如AFL++），AFGEN在漏洞发现数量上领先，发现了第二名工具的2倍漏洞。
  - AFGEN触发的崩溃报告精确度为77.1%，是FUDGE工具精确度的10倍。
  - AFGEN还发现了24个未公开的未知漏洞，并成功为这些漏洞分配了CVE编号。

### **结论**
- **AFGEN**展示了全函数模糊测试的有效性，并且通过自动化的方式生成了高质量的测试用例，显著提高了漏洞发现的精确度和覆盖率。

### **总结**
这篇论文的贡献在于提出了一种新的模糊测试方法，能够覆盖整个程序或库的所有函数，而不仅限于API函数。通过全函数的模糊测试，AFGEN能够发现大量的已知和未知漏洞，而且生成的测试用例具有较高的精确度，能够减少测试过程中的无效崩溃报告。
